---
title: "Stat 151a Project"
author: "Kelly Trinh, Hanfei Sun, and Nathan Lam"
output: pdf_document
---

https://www.rdocumentation.org/packages/fivethirtyeight/versions/0.6.1/topics/college_recent_grads


```{r Libraries, message=FALSE, warning=FALSE}
library(fivethirtyeight) #source of data
library(corrplot) #correlation plot
library(dplyr) #data frame manipulation
library(ggplot2) #plotting
library(leaps)#variable selection: adjr2, bic, cp
library(olsrr)#variable selection: aic, p-val
library(fastDummies)
library(faraway)
library(caret)
```

```{r}
crg <- college_recent_grads
cont <- select_if(crg, is.numeric)
cont["college_job_prop"] <- cont$college_jobs / (cont$college_jobs + cont$non_college_jobs)
cont["full_time_yearround_prop"] <- cont$employed_fulltime_yearround / cont$employed
cont <- na.omit(cont)
corrplot(cor(cont), type = "upper", order = "AOE")
crg["log_median"] <- log(crg$median)
crg["college_job_prop"] <- crg$college_jobs / (crg$college_jobs + crg$non_college_jobs)
crg["full_time_yearround_prop"] <- crg$employed_fulltime_yearround / crg$employed
crg <- na.omit(crg)



crg <- dummy_cols(crg, select_columns = "major_category", remove_selected_col = TRUE,remove_first_dummy = TRUE)
column_names <- make.names(names(crg),unique=TRUE)
colnames(crg) <- column_names





```

```{r}
ggplot(aes(x = major_category, y = log_median), data = crg) + geom_boxplot() + coord_flip()
```

```{r Variable Selection}
Y <- as.matrix(crg$log_median)

X <- as.matrix(subset(crg,select=-c(log_median,median, major_code, p25th, p75th, major)))
# Check for linear dependencies, remove "men" or "total"
alias(lm(Y~X))
X <- as.matrix(subset(crg,select=-c(log_median,median, major_code, p25th, p75th, major, men)))
```

```{r}
#Forward Selection
model <- regsubsets(x = X, y = Y, method = "forward", nbest = 1) %>% summary()

adjustr2 <- model$adjr2
BIC <- model$bic
mallow_Cp <- model$cp


cbind(model$which[which.max(adjustr2),], model$which[which.min(BIC),],model$which[which.min(mallow_Cp),])


###################
#Backward Selection

model <- regsubsets(x = X, y = Y, method = "backward", nbest = 1) %>% summary()


adjustr2 <- model$adjr2
BIC <- model$bic
mallow_Cp <- model$cp
cbind(model$which[which.max(adjustr2),], model$which[which.min(BIC),],model$which[which.min(mallow_Cp),])
```

### Cross Validation

```{r}
# Backward Adjusted R-squared CV
tc <- trainControl(method = "LOOCV")
b_adjr2_mod_cv <- train(log_median ~ employed + employed_fulltime_yearround + 
                          college_job_prop +
                          major_category_Biology...Life.Science+
                          major_category_Computers...Mathematics + 
                          rank + sharewomen + major_category_Engineering , data = crg, method = "lm",
               trControl = tc)
b_adjr2_mod_cv$results["RMSE"]
```


```{r}
# Backward BIC CV
b_bic_mod_cv <- train(log_median ~ rank + college_job_prop +  major_category_Engineering, data = crg, method = "lm", trControl = tc )
b_bic_mod_cv$results["RMSE"]
```

```{r}
# Backward Mallow's Cp CV
b_cp_mod_cv <- train(log_median ~ employed + employed_fulltime_yearround + 
                       college_job_prop +  major_category_Biology...Life.Science
                     + major_category_Computers...Mathematics + rank +
                       major_category_Engineering + sharewomen , data = crg , 
                     method = "lm", trControl = tc)
b_cp_mod_cv$results["RMSE"]
```


```{r}
# Forward Adjusted R-squared CV
f_adjr2_model_cv <- train(log_median ~ rank + unemployment_rate + 
                           college_job_prop + major_category_Arts + 
                           major_category_Biology...Life.Science  + 
                           major_category_Engineering  + 
                           major_category_Humanities...Liberal.Arts  + 
                           major_category_Industrial.Arts...Consumer.Services , 
                           data = crg, method = "lm", trControl = tc)

f_adjr2_model_cv$results["RMSE"]

# Forward BIC CV
f_BIC_model_cv <- train(log_median ~ rank + college_job_prop + 
                           major_category_Engineering, 
                       data = crg, method = "lm", trControl = tc)

f_BIC_model_cv$results["RMSE"]

# Forward Mallow's Cp CV
f_Cp_model_cv <- train(log_median ~ rank + unemployment_rate + 
                          college_job_prop + major_category_Arts + 
                         major_category_Engineering + 
                         major_category_Humanities...Liberal.Arts, 
                      data = crg, method = "lm", trControl = tc)

f_Cp_model_cv$results["RMSE"]
```


```{r}
#interactions

model <- lm(log_median ~ rank + unemployment_rate + 
                          college_job_prop + major_category_Arts + 
                         major_category_Engineering + 
                         major_category_Humanities...Liberal.Arts, 
                      data = crg)
model1 <- lm(log_median ~ rank + unemployment_rate + 
                          college_job_prop + major_category_Arts + 
                         major_category_Engineering + 
                         major_category_Humanities...Liberal.Arts + 
                         college_job_prop*major_category_Arts, 
                      data = crg)
model2 <- lm(log_median ~ rank + unemployment_rate + 
                          college_job_prop + major_category_Arts + 
                         major_category_Engineering + 
                         major_category_Humanities...Liberal.Arts + 
                         college_job_prop*major_category_Arts + 
                         college_job_prop*major_category_Engineering, 
                      data = crg)

model3 <- lm(log_median ~ rank + unemployment_rate + 
                          college_job_prop + major_category_Arts + 
                         major_category_Engineering + 
                         major_category_Humanities...Liberal.Arts + 
                         college_job_prop*major_category_Arts + 
                         college_job_prop*major_category_Engineering + 
                   college_job_prop*major_category_Humanities...Liberal.Arts, 
                      data = crg)

anova(model, model1, model2, model3)

```






