---
title: "Stat 151a Project"
author: "Kelly Trinh, Hanfei Sun, and Nathan Lam"
output: pdf_document
---

https://www.rdocumentation.org/packages/fivethirtyeight/versions/0.6.1/topics/college_recent_grads


```{r Libraries, message=FALSE, warning=FALSE}
library(fivethirtyeight) #source of data
library(corrplot) #correlation plot
library(dplyr) #data frame manipulation
library(ggplot2) #plotting
library(leaps)#variable selection: adjr2, bic, cp
library(olsrr)#variable selection: aic, p-val
library(fastDummies)
library(faraway)
library(caret)
```

```{r}
crg <- college_recent_grads
cont <- select_if(crg, is.numeric)
cont["college_job_prop"] <- cont$college_jobs / (cont$college_jobs + cont$non_college_jobs)
cont["full_time_yearround_prop"] <- cont$employed_fulltime_yearround / cont$employed
cont <- na.omit(cont)
corrplot(cor(cont), type = "upper", order = "AOE")
crg["log_median"] <- log(crg$median)
crg["college_job_prop"] <- crg$college_jobs / (crg$college_jobs + crg$non_college_jobs)
crg["full_time_yearround_prop"] <- crg$employed_fulltime_yearround / crg$employed
crg <- na.omit(crg)
crg <- dummy_cols(crg, select_columns = "major_category", remove_selected_columns = TRUE, remove_first_dummy = TRUE)
column_names <- make.names(names(crg),unique=TRUE)
colnames(crg) <- column_names
```

```{r}
ggplot(aes(x = major_category, y = log_median), data = crg) + geom_boxplot() + coord_flip()
```

```{r Variable Selection}
Y <- as.matrix(crg$log_median)
X <- as.matrix(subset(crg,select=-c(log_median,median, major_code, p25th, p75th, major)))
# Check for linear dependencies, remove "men" or "total"
alias(lm(Y~X))
```

```{r}
#Forward Selection
model <- regsubsets(x = X, y = Y, method = "forward", nbest = 1) %>% summary()

adjustr2 <- model$adjr2
model$which[which.max(adjustr2),]

BIC <- model$bic
model$which[which.min(BIC),]

mallow_Cp <- model$cp
model$which[which.min(mallow_Cp),]


###################
#Backward Selection

model <- regsubsets(x = X, y = Y, method = "backward", nbest = 1) %>% summary()
findDesp

adjustr2 <- model$adjr2
model$which[which.max(adjustr2),]

BIC <- model$bic
model$which[which.min(BIC),]

mallow_Cp <- model$cp
model$which[which.min(mallow_Cp),]
```
```{r}
# CV
tc <- trainControl(method = "LOOCV")
adjr2_cv <- 
```


variables to include
intercept
total (Backward p-val)
rank
men (Forward adjr2, Backward adjr2, Backward Cp, Backward AIC)
women (Backward p-val)
sharewomen
low_wage_jobs (Forward adjr2, Backward adjr2, Backward Cp, Backward AIC)
college_job_prop
full_time_yearround_prop


variables to exclude
total (Forward adjr2, Forward BIC, Forward Cp, Backward AIC)
sample_size
men (Forward BIC, Forward Cp, Backward BIC)
women (Forward adjr2, Forward BIC, Forward Cp, Backward AIC)
employed
employed_fulltime
employed_parttime
employed_fulltime_yearround
unemployed
unemployment_rate
college_jobs
non_college_jobs
low_wage_jobs (Forward BIC, Forward Cp, Backward Cp)



have been selected by all methods
rank
sharewomen
college_job_prop
full_time_yearround_prop









